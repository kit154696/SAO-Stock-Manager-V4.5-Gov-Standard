<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ß‡∏±‡∏™‡∏î‡∏∏ ‡∏≠‡∏õ‡∏ó. (‡∏ß 1095 Edition)</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        /* --- Themes & Variables --- */
        :root {
            --primary: #2980b9; /* ‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ */
            --header-bg: #ecf0f1;
            --success: #27ae60; 
            --danger: #c0392b; 
            --void: #95a5a6;
            --bg-body: #f4f6f9;
            --sidebar-width: 260px;
        }
        
        * { box-sizing: border-box; font-family: 'Sarabun', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0; background: var(--bg-body); display: flex; height: 100vh; overflow: hidden; }

        /* --- Header & Sidebar --- */
        .mobile-header {
            display: none; background: var(--primary); color: white; padding: 15px; 
            align-items: center; justify-content: space-between; position: fixed; top: 0; left: 0; right: 0; z-index: 900; height: 60px;
        }
        
        .sidebar { 
            width: var(--sidebar-width); background: #2c3e50; color: white; display: flex; flex-direction: column; padding: 20px; 
            transition: transform 0.3s ease; z-index: 1000; box-shadow: 2px 0 5px rgba(0,0,0,0.1); overflow-y: auto;
        }
        .sidebar h2 { text-align: center; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 15px; margin-bottom: 20px; font-size: 18px; }
        .close-sidebar { display: none; position: absolute; top: 15px; right: 15px; font-size: 24px; cursor: pointer; }
        
        .menu-item { padding: 12px 15px; cursor: pointer; border-radius: 4px; margin-bottom: 5px; display: flex; align-items: center; gap: 10px; color: #bdc3c7; transition: 0.2s; }
        .menu-item:hover, .menu-item.active { background: var(--primary); color: white; }

        .org-input {
            background: rgba(0,0,0,0.2); border: 1px solid #555; color: #fff; padding: 8px; width: 100%; border-radius: 4px; margin-bottom: 20px; font-size: 13px;
        }

        /* --- Main Content --- */
        .main-content { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; }
        .section { display: none; animation: fadeIn 0.3s; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Cards & Forms --- */
        .card { background: white; border-radius: 4px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 20px; border-top: 3px solid var(--primary); }
        .summary-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px; }
        .stat-box { background: #fff; padding: 15px; border: 1px solid #ddd; border-radius: 4px; text-align: center; }
        .stat-box h4 { margin: 0 0 5px; font-size: 14px; color: #7f8fa6; }
        .stat-box .val { font-size: 22px; font-weight: bold; color: #2c3e50; }

        .form-row { display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap; }
        .form-group { flex: 1; min-width: 200px; }
        label { display: block; font-size: 13px; font-weight: bold; margin-bottom: 5px; color: #34495e; }
        input, select { width: 100%; padding: 10px; border: 1px solid #bdc3c7; border-radius: 4px; background: #fff; }
        
        .btn { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; color: white; display: inline-flex; align-items: center; gap: 5px; }
        .btn-primary { background: var(--primary); }
        .btn-success { background: var(--success); }
        .btn-danger { background: var(--danger); }
        .btn-void { background: var(--void); }

        /* --- Excel-like Tables --- */
        .table-responsive { overflow-x: auto; border: 1px solid #ddd; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; min-width: 800px; }
        th { background: #f0f0f0; padding: 10px; border: 1px solid #ccc; text-align: center; color: #333; font-weight: bold; white-space: nowrap; }
        td { padding: 8px; border: 1px solid #ccc; vertical-align: middle; }
        .text-right { text-align: right; }
        .text-center { text-align: center; }
        tr:nth-child(even) { background: #fafafa; }

        /* --- Mobile Responsive --- */
        @media (max-width: 768px) {
            .mobile-header { display: flex; }
            .sidebar { position: fixed; top: 0; bottom: 0; left: 0; transform: translateX(-100%); z-index: 1001; }
            .sidebar.show { transform: translateX(0); }
            .close-sidebar { display: block; }
            .overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 950; }
            .overlay.show { display: block; }
            .main-content { padding-top: 80px; }
            .summary-grid { grid-template-columns: 1fr 1fr; }
            .form-group { min-width: 100%; }
        }
        @media print {
            .sidebar, .mobile-header, .no-print, .btn { display: none !important; }
            body, .main-content { padding: 0; margin: 0; background: white; height: auto; overflow: visible; }
            .card { box-shadow: none; border: none; }
            table { width: 100%; border: 1px solid #000; }
            th, td { border: 1px solid #000; }
        }
    </style>
</head>
<body>

<div class="mobile-header">
    <i class="fas fa-bars" style="font-size:24px; cursor:pointer;" onclick="toggleSidebar()"></i>
    <span style="font-weight:bold;">‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏±‡∏™‡∏î‡∏∏ ‡∏≠‡∏õ‡∏ó.</span>
    <span></span>
</div>
<div class="overlay" onclick="toggleSidebar()"></div>

<nav class="sidebar" id="sidebar">
    <div class="close-sidebar" onclick="toggleSidebar()"><i class="fas fa-times"></i></div>
    <h2>üèõÔ∏è ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏Å‡∏•‡∏≤‡∏á</h2>
    
    <div style="padding: 0 10px;">
        <label style="color: #bdc3c7; font-size: 12px;">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô (‡∏≠‡∏õ‡∏ó.):</label>
        <input type="text" id="orgNameInput" class="org-input" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏≥‡∏ö‡∏•..." onchange="updateOrgName(this.value)">
    </div>

    <div class="menu-item active" onclick="nav('dashboard')"><i class="fas fa-chart-line"></i> ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° (Dashboard)</div>
    <div class="menu-item" onclick="nav('transaction')"><i class="fas fa-edit"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡∏£‡∏±‡∏ö-‡∏à‡πà‡∏≤‡∏¢</div>
    <div class="menu-item" onclick="nav('master')"><i class="fas fa-box"></i> ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ß‡∏±‡∏™‡∏î‡∏∏</div>
    <div class="menu-item" onclick="nav('report')"><i class="fas fa-file-alt"></i> ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</div>
    
    <div style="margin-top:auto; font-size:12px; opacity:0.7; padding-top:20px; border-top:1px solid #444;">
        <div style="margin-bottom:5px;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
        <button onclick="backupData()" style="width:100%; background:none; border:1px solid #777; color:#ddd; padding:5px; cursor:pointer; margin-bottom:5px;">Backup</button>
        <input type="file" id="restoreFile" hidden onchange="restoreData(this)">
        <button onclick="document.getElementById('restoreFile').click()" style="width:100%; background:none; border:1px solid #777; color:#ddd; padding:5px; cursor:pointer;">Restore</button>
    </div>
</nav>

<main class="main-content">

    <div id="dashboard" class="section active">
        <div class="card">
            <h3>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏û‡∏±‡∏™‡∏î‡∏∏</h3>
            <div class="summary-grid">
                <div class="stat-box"><h4>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</h4><div class="val" id="d-total-val">0</div></div>
                <div class="stat-box"><h4>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß</h4><div class="val" id="d-tx-count">0</div></div>
                <div class="stat-box"><h4>‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î (‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</h4><div class="val" id="d-low-stock" style="color:#d35400">0</div></div>
                <div class="stat-box"><h4>‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢ (‡∏Ñ‡∏£‡∏±‡πâ‡∏á)</h4><div class="val" id="d-out-count">0</div></div>
            </div>
            <div style="height:250px;"><canvas id="chartCat"></canvas></div>
        </div>
    </div>

    <div id="transaction" class="section">
        <div class="card">
            <h3>üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏£‡∏±‡∏ö-‡∏à‡πà‡∏≤‡∏¢)</h3>
            <form id="txForm" onsubmit="saveTx(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡∏ß‡∏ß/‡∏î‡∏î/‡∏õ‡∏õ‡∏õ‡∏õ)</label>
                        <input type="date" id="txDate" required>
                    </div>
                    <div class="form-group">
                        <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
                        <select id="txType" onchange="toggleTxUI()" required>
                            <option value="OUT">üî¥ ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å (‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å)</option>
                            <option value="IN">üü¢ ‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ (‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏±‡∏ö)</option>
                        </select>
                    </div>
                </div>

                <div style="background:#f9f9f9; padding:15px; border:1px solid #eee; margin-bottom:15px;">
                    <div class="form-row">
                        <div class="form-group" style="flex:2;">
                            <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏™‡∏î‡∏∏</label>
                            <input type="text" id="txItem" list="dlItems" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." onchange="fillItemData()" required>
                            <datalist id="dlItems"></datalist>
                            <input type="hidden" id="txItemId">
                        </div>
                        <div class="form-group">
                            <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</label>
                            <input type="number" id="txQty" min="1" required style="font-weight:bold;">
                        </div>
                        <div class="form-group">
                            <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ô‡∏±‡∏ö</label>
                            <input type="text" id="txUnit" readonly>
                        </div>
                    </div>
                    
                    <div class="form-row" id="priceRow" style="display:none;">
                        <div class="form-group">
                            <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢ (‡∏ö‡∏≤‡∏ó)</label>
                            <input type="number" id="txPrice" min="0" step="0.01" value="0">
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label id="lblRef">‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å/‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏´‡πâ (‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô/‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤)</label>
                        <input type="text" id="txRef" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≠‡∏á‡∏Ñ‡∏•‡∏±‡∏á, ‡∏£‡πâ‡∏≤‡∏ô‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏†‡∏±‡∏ì‡∏ë‡πå">
                    </div>
                    <div class="form-group">
                        <label>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (‡πÉ‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å/‡πÉ‡∏ö‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á)</label>
                        <input type="text" id="txDoc" placeholder="‡πÄ‡∏ä‡πà‡∏ô 15/2569">
                    </div>
                </div>

                <button type="submit" class="btn btn-primary" style="width:100%"><i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </form>
        </div>

        <div class="card">
            <h4>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h4>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th>‡∏£‡∏±‡∏ö</th><th>‡∏à‡πà‡∏≤‡∏¢</th><th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th><th>‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th>‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á</th><th>‡∏•‡∏ö</th></tr>
                    </thead>
                    <tbody id="tbTx"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="master" class="section">
        <div class="card">
            <h3>üì¶ ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏∏‡∏°‡∏ß‡∏±‡∏™‡∏î‡∏∏ (Master Items)</h3>
            <div class="form-row">
                <div class="form-group" style="flex:2">
                    <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏™‡∏î‡∏∏</label>
                    <input type="text" id="mName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© A4, ‡∏´‡∏°‡∏∂‡∏Å‡∏û‡∏¥‡∏°‡∏û‡πå">
                </div>
                <div class="form-group" style="flex:2">
                    <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (‡∏ï‡∏≤‡∏° ‡∏ß 1095)</label>
                    <select id="mCat">
                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ß‡∏±‡∏™‡∏î‡∏∏ --</option>
                        <option>1. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</option>
                        <option>2. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏∏</option>
                        <option>3. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏á‡∏≤‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏±‡∏ß</option>
                        <option>4. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á</option>
                        <option>5. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏¢‡∏≤‡∏ô‡∏û‡∏≤‡∏´‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡∏Ç‡∏ô‡∏™‡πà‡∏á</option>
                        <option>6. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏•‡∏¥‡∏á‡πÅ‡∏•‡∏∞‡∏´‡∏•‡πà‡∏≠‡∏•‡∏∑‡πà‡∏ô</option>
                        <option>7. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå</option>
                        <option>8. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏©‡∏ï‡∏£</option>
                        <option>9. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà</option>
                        <option>10. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏≤‡∏¢</option>
                        <option>11. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏Å‡∏µ‡∏¨‡∏≤</option>
                        <option>12. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</option>
                        <option>13. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
                        <option>14. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏±‡∏ö‡πÄ‡∏û‡∏•‡∏¥‡∏á</option>
                        <option>15. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏™‡∏ô‡∏≤‡∏°</option>
                        <option>16. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏™‡∏≥‡∏£‡∏ß‡∏à</option>
                        <option>17. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏î‡∏ô‡∏ï‡∏£‡∏µ‡πÅ‡∏•‡∏∞‡∏ô‡∏≤‡∏è‡∏®‡∏¥‡∏•‡∏õ‡πå</option>
                        <option>18. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏à‡∏£‡∏≤‡∏à‡∏£</option>
                        <option>19. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏≠‡∏∑‡πà‡∏ô</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>‡∏Ñ‡∏∏‡∏ì‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞/‡∏Ç‡∏ô‡∏≤‡∏î</label>
                    <input type="text" id="mSpec" placeholder="‡πÄ‡∏ä‡πà‡∏ô 80 ‡πÅ‡∏Å‡∏£‡∏°, ‡∏™‡∏µ‡∏î‡∏≥">
                </div>
                <div class="form-group">
                    <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ô‡∏±‡∏ö</label>
                    <input type="text" id="mUnit" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏•‡πà‡∏≠‡∏á, ‡πÅ‡∏ú‡πà‡∏ô">
                </div>
                <div class="form-group" style="display:flex; align-items:end;">
                    <button onclick="addMaster()" class="btn btn-success" style="width:100%;"><i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
                </div>
            </div>
            
            <div class="table-responsive" style="margin-top:10px;">
                <table>
                    <thead>
                        <tr><th>‡∏ó‡∏µ‡πà</th><th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th>‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞</th><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th><th>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr>
                    </thead>
                    <tbody id="tbMaster"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="report" class="section">
        <div class="card">
            <div class="no-print" style="display:flex; justify-content:space-between; margin-bottom:15px;">
                <h3>üìë ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</h3>
                <button onclick="window.print()" class="btn btn-primary"><i class="fas fa-print"></i> ‡∏û‡∏¥‡∏°‡∏û‡πå</button>
            </div>
            
            <div class="text-center" style="margin-bottom:20px;">
                <h3 id="reportHeaderOrg">‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏≥‡∏ö‡∏•....</h3>
                <h4>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì <span id="reportYear">256X</span></h4>
            </div>

            <div class="no-print form-row">
                 <div class="form-group">
                     <label>‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                     <select id="repFilter" onchange="renderReport()">
                         <option value="ALL">-- ‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà --</option>
                         <option>1. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</option>
                         <option>2. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏∏</option>
                         <option>3. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏á‡∏≤‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏±‡∏ß</option>
                         <option>4. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á</option>
                         <option>5. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏¢‡∏≤‡∏ô‡∏û‡∏≤‡∏´‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡∏Ç‡∏ô‡∏™‡πà‡∏á</option>
                         <option>6. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏•‡∏¥‡∏á‡πÅ‡∏•‡∏∞‡∏´‡∏•‡πà‡∏≠‡∏•‡∏∑‡πà‡∏ô</option>
                         <option>7. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå</option>
                         <option>8. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏©‡∏ï‡∏£</option>
                         <option>9. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà</option>
                         <option>10. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏≤‡∏¢</option>
                         <option>11. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏Å‡∏µ‡∏¨‡∏≤</option>
                         <option>12. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</option>
                         <option>13. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
                         <option>14. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏±‡∏ö‡πÄ‡∏û‡∏•‡∏¥‡∏á</option>
                         <option>15. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏™‡∏ô‡∏≤‡∏°</option>
                         <option>16. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏™‡∏≥‡∏£‡∏ß‡∏à</option>
                         <option>17. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏î‡∏ô‡∏ï‡∏£‡∏µ‡πÅ‡∏•‡∏∞‡∏ô‡∏≤‡∏è‡∏®‡∏¥‡∏•‡∏õ‡πå</option>
                         <option>18. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏à‡∏£‡∏≤‡∏à‡∏£</option>
                         <option>19. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏≠‡∏∑‡πà‡∏ô</option>
                     </select>
                 </div>
            </div>

            <div class="table-responsive">
                <table id="repTable">
                    <thead>
                        <tr>
                            <th rowspan="2" style="width:50px;">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                            <th rowspan="2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                            <th rowspan="2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏™‡∏î‡∏∏ (‡∏Ç‡∏ô‡∏≤‡∏î/‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞)</th>
                            <th colspan="3">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                            <th rowspan="2">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                        </tr>
                        <tr>
                            <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                            <th>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                            <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</th>
                        </tr>
                    </thead>
                    <tbody id="tbReport"></tbody>
                    <tfoot>
                        <tr style="background:#eee; font-weight:bold;">
                            <td colspan="5" class="text-right">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô</td>
                            <td class="text-right" id="repTotalMoney">0.00</td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

</main>

<script>
    // --- Data & Init ---
    let DB = { items: [], tx: [] };
    const DEFAULT_ORG = "‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏≥‡∏ö‡∏• (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)";
    let orgName = localStorage.getItem('OrgName') || DEFAULT_ORG;

    // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    const initData = [
        {name: "‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© A4", spec: "80 ‡πÅ‡∏Å‡∏£‡∏°", cat: "1. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô", unit: "‡∏£‡∏µ‡∏°", price: 120, bal: 50},
        {name: "‡πÅ‡∏ü‡πâ‡∏°‡πÅ‡∏Ç‡∏ß‡∏ô", spec: "‡∏™‡∏µ‡∏™‡πâ‡∏°", cat: "1. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô", unit: "‡πÄ‡∏•‡πà‡∏°", price: 15, bal: 100},
        {name: "‡∏´‡∏•‡∏≠‡∏î‡πÑ‡∏ü LED", spec: "18 ‡∏ß‡∏±‡∏ï‡∏ï‡πå", cat: "2. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏∏", unit: "‡∏´‡∏•‡∏≠‡∏î", price: 80, bal: 20},
        {name: "‡∏´‡∏°‡∏∂‡∏Å‡∏û‡∏¥‡∏°‡∏û‡πå Canon", spec: "PG-810 ‡∏™‡∏µ‡∏î‡∏≥", cat: "12. ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå", unit: "‡∏ï‡∏•‡∏±‡∏ö", price: 650, bal: 5}
    ];

    window.onload = () => {
        loadDB();
        // Setup Org Name
        document.getElementById('orgNameInput').value = orgName;
        document.getElementById('reportHeaderOrg').innerText = orgName;
        
        // Setup Year
        const currentYear = new Date().getFullYear() + 543;
        document.getElementById('reportYear').innerText = currentYear;

        if(DB.items.length === 0) {
            initData.forEach(d => {
                DB.items.push({id: Date.now()+Math.random(), name: d.name, spec: d.spec, cat: d.cat, unit: d.unit, price: d.price});
                // Fake Init Balance
                DB.tx.push({id: Date.now()+Math.random(), date: '2025-10-01', type: 'IN', itemId: DB.items[DB.items.length-1].id, qty: d.bal, price: d.price, ref: '‡∏¢‡∏≠‡∏î‡∏¢‡∏Å‡∏°‡∏≤', doc: '-'});
            });
            saveDB();
        }
        document.getElementById('txDate').valueAsDate = new Date();
        renderAll();
    };

    // --- Core Functions ---
    function nav(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(window.innerWidth <= 768) toggleSidebar();
        if(id === 'report') renderReport();
    }

    function toggleSidebar() {
        document.getElementById('sidebar').classList.toggle('show');
        document.querySelector('.overlay').classList.toggle('show');
    }

    function updateOrgName(val) {
        orgName = val || DEFAULT_ORG;
        localStorage.setItem('OrgName', orgName);
        document.getElementById('reportHeaderOrg').innerText = orgName;
    }

    function toggleTxUI() {
        const type = document.getElementById('txType').value;
        document.getElementById('priceRow').style.display = (type === 'IN') ? 'flex' : 'none';
        document.getElementById('lblRef').innerText = (type === 'IN') ? '‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å (‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤)' : '‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏´‡πâ (‡∏Å‡∏≠‡∏á/‡∏ù‡πà‡∏≤‡∏¢)';
    }

    function fillItemData() {
        const name = document.getElementById('txItem').value;
        const item = DB.items.find(i => i.name === name);
        if(item) {
            document.getElementById('txItemId').value = item.id;
            document.getElementById('txUnit').value = item.unit;
            document.getElementById('txPrice').value = item.price; 
        }
    }

    function saveTx(e) {
        e.preventDefault();
        const itemId = document.getElementById('txItemId').value;
        const item = DB.items.find(i => i.id == itemId);
        
        if(!item) { alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ß‡∏±‡∏™‡∏î‡∏∏ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Å‡πà‡∏≠‡∏ô'); return; }

        const type = document.getElementById('txType').value;
        const qty = parseFloat(document.getElementById('txQty').value);
        const price = parseFloat(document.getElementById('txPrice').value) || 0;

        if(type === 'OUT') {
            const bal = getBal(itemId);
            if(qty > bal) { alert(`‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏û‡∏≠ (‡∏°‡∏µ ${bal})`); return; }
        } else {
            // Update Last Price on IN
            item.price = price; 
        }

        const tx = {
            id: Date.now(),
            date: document.getElementById('txDate').value,
            type: type,
            itemId: parseFloat(itemId),
            qty: qty,
            price: type==='IN'?price:item.price,
            ref: document.getElementById('txRef').value,
            doc: document.getElementById('txDoc').value
        };

        DB.tx.push(tx);
        saveDB();
        renderTxTable();
        renderDashboard();
        e.target.reset();
        document.getElementById('txDate').valueAsDate = new Date();
    }

    function addMaster() {
        const name = document.getElementById('mName').value;
        const spec = document.getElementById('mSpec').value;
        const cat = document.getElementById('mCat').value;
        const unit = document.getElementById('mUnit').value;

        if(!name || !cat || !unit) {
            alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô'); return;
        }

        DB.items.push({
            id: Date.now(),
            name: name,
            spec: spec,
            cat: cat,
            unit: unit,
            price: 0
        });
        saveDB();
        renderMasterTable();
        
        // Clear Form
        document.getElementById('mName').value = '';
        document.getElementById('mSpec').value = '';
        document.getElementById('mUnit').value = '';
    }

    // --- Render Logic ---
    function getBal(itemId) {
        return DB.tx.filter(t => t.itemId == itemId).reduce((acc, t) => acc + (t.type==='IN'?t.qty:-t.qty), 0);
    }

    function renderAll() {
        updateDatalist();
        renderTxTable();
        renderMasterTable();
        renderDashboard();
    }

    function updateDatalist() {
        document.getElementById('dlItems').innerHTML = DB.items.map(i => `<option value="${i.name}">`).join('');
    }

    function renderTxTable() {
        const tbody = document.getElementById('tbTx');
        tbody.innerHTML = '';
        DB.tx.slice().reverse().slice(0, 50).forEach(t => {
            const item = DB.items.find(i => i.id == t.itemId);
            tbody.innerHTML += `
                <tr>
                    <td>${formatDate(t.date)}</td>
                    <td>${item?item.name:'-'}</td>
                    <td class="text-center" style="color:green">${t.type==='IN'?t.qty:'-'}</td>
                    <td class="text-center" style="color:red">${t.type==='OUT'?t.qty:'-'}</td>
                    <td class="text-center">--</td> 
                    <td class="text-right">${t.price}</td>
                    <td>${t.ref} <small class="text-muted">#${t.doc}</small></td>
                    <td class="text-center"><button class="btn-danger" style="padding:2px 5px;" onclick="delTx(${t.id})">√ó</button></td>
                </tr>
            `;
        });
    }

    function renderMasterTable() {
        const tbody = document.getElementById('tbMaster');
        tbody.innerHTML = '';
        DB.items.forEach((i, idx) => {
            tbody.innerHTML += `
                <tr>
                    <td class="text-center">${idx+1}</td>
                    <td>${i.name}</td>
                    <td><small style="color:#666">${i.spec || '-'}</small></td>
                    <td>${i.cat}</td>
                    <td class="text-center">${i.unit}</td>
                    <td class="text-center font-weight-bold">${getBal(i.id)}</td>
                    <td class="text-right">${i.price}</td>
                    <td class="text-center"><button class="btn-danger" onclick="delItem(${i.id})">‡∏•‡∏ö</button></td>
                </tr>
            `;
        });
    }

    function renderReport() {
        const filter = document.getElementById('repFilter').value;
        const tbody = document.getElementById('tbReport');
        tbody.innerHTML = '';
        let totalMoney = 0;
        let seq = 1;

        // Sort Items by Category then Name
        const sortedItems = [...DB.items].sort((a,b) => a.cat.localeCompare(b.cat) || a.name.localeCompare(b.name));

        sortedItems.forEach(i => {
            if(filter !== 'ALL' && i.cat !== filter) return;
            const bal = getBal(i.id);
            if(bal === 0) return; 
            
            const money = bal * i.price;
            totalMoney += money;

            tbody.innerHTML += `
                <tr>
                    <td class="text-center">${seq++}</td>
                    <td>${i.cat}</td>
                    <td>
                        <b>${i.name}</b>
                        <div style="font-size:12px; color:#555;">${i.spec || ''}</div>
                    </td>
                    <td class="text-center">${bal} ${i.unit}</td>
                    <td class="text-right">${i.price.toLocaleString()}</td>
                    <td class="text-right">${money.toLocaleString(undefined, {minimumFractionDigits:2})}</td>
                    <td></td>
                </tr>
            `;
        });
        document.getElementById('repTotalMoney').innerText = totalMoney.toLocaleString(undefined, {minimumFractionDigits:2});
    }

    function renderDashboard() {
        let totalVal = 0;
        let lowStock = 0;
        const catCount = {};

        DB.items.forEach(i => {
            const bal = getBal(i.id);
            totalVal += bal * i.price;
            if(bal < 5) lowStock++;
            catCount[i.cat] = (catCount[i.cat] || 0) + 1;
        });

        document.getElementById('d-total-val').innerText = totalVal.toLocaleString(undefined, {minimumFractionDigits:0});
        document.getElementById('d-tx-count').innerText = DB.tx.length;
        document.getElementById('d-low-stock').innerText = lowStock;
        document.getElementById('d-out-count').innerText = DB.tx.filter(t => t.type === 'OUT').length;

        // Chart
        const ctx = document.getElementById('chartCat').getContext('2d');
        if(window.myChart) window.myChart.destroy();
        window.myChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: Object.keys(catCount),
                datasets: [{ data: Object.values(catCount), backgroundColor: ['#3498db','#e74c3c','#f1c40f','#2ecc71','#9b59b6'] }]
            },
            options: { responsive: true, maintainAspectRatio: false }
        });
    }

    // --- Utils ---
    function formatDate(d) {
        const date = new Date(d);
        return `${date.getDate()}/${date.getMonth()+1}/${date.getFullYear()+543}`;
    }
    
    function delTx(id) {
        if(confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?')) {
            DB.tx = DB.tx.filter(t => t.id !== id);
            saveDB(); renderAll();
        }
    }
    
    function delItem(id) {
        if(confirm('‡∏•‡∏ö‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ß‡∏±‡∏™‡∏î‡∏∏? (‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢)')) {
            DB.items = DB.items.filter(i => i.id !== id);
            DB.tx = DB.tx.filter(t => t.itemId !== id);
            saveDB(); renderAll();
        }
    }

    function saveDB() { localStorage.setItem('SAO_V4_5', JSON.stringify(DB)); }
    function loadDB() { const d = localStorage.getItem('SAO_V4_5'); if(d) DB = JSON.parse(d); }
    
    function backupData() {
        const a = document.createElement('a');
        a.href = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(DB));
        a.download = "sao_backup.json"; a.click();
    }
    function restoreData(input) {
        const r = new FileReader();
        r.onload = e => { DB = JSON.parse(e.target.result); saveDB(); location.reload(); };
        r.readAsText(input.files[0]);
    }
</script>
</body>
</html>
